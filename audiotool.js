// https://github.com/makc/audiotool.js
function Audiotool(){var t=function(t,e,a){var n=new XMLHttpRequest;n.open("GET",t),n.onerror=n.ontimeout=n.onabort=function(){e&&e(),e=null},a(n),n.send()},e=function(e,a,n){t(e,n,function(t){t.responseType="arraybuffer",t.onreadystatechange=function(){if(4==t.readyState){var e=new Uint8Array(t.response);if(e[0]!="P".charCodeAt(0))return n&&n();if(e[1]!="E".charCodeAt(0))return n&&n();if(e[2]!="A".charCodeAt(0))return n&&n();if(e[3]!="K".charCodeAt(0))return n&&n();var r=e.length;if(r!=256*e[8]+e[9]+10)return n&&n();for(var o=new Array(r-10),i=10;r>i;i++)o[i-10]=e[i];a(o)}}})};this.getPeaks=e,this.getRandomTrack=function(a,n){t("https://api.audiotool.com/tracks/relevant/?limit=0",n,function(r){r.onreadystatechange=function(){if(4==r.readyState){var o=r.response.match(/<tracks offset="0" limit="0" count="(\d+)"/);if(o){var i=Math.random()*o[1]|0;t("https://api.audiotool.com/tracks/relevant/?limit=1&offset="+i,n,function(t){t.onreadystatechange=function(){if(4==t.readyState){var r={response:t.response.toString()};r.urls=[r.response.match(/<playbackURL mime-type="audio\/mpeg">([^<]+)/)[1],r.response.match(/<playbackURL mime-type="application\/ogg">([^<]+)/)[1]],r.bpm=parseFloat(r.response.match(/<bpm>([^<]+)/)[1]),r.cover=r.response.match(/<coverURL width="512" height="512">([^<]+)/)[1];var o=r.response.match(/<name>([^<]+)/g);r.name=o[0].match(/>([^<]+)/)[1],r.author=o[1].match(/>([^<]+)/)[1],e(r.response.match(/<peaksURL mime-type="application\/octet-stream">([^<]+)/)[1],function(t){r.peaks=t,a(r)},n)}}})}else n&&n()}}})}}