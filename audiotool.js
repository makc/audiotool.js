// https://github.com/makc/audiotool.js
function Audiotool(){var a=function(a,t,e){var n=new XMLHttpRequest;n.open("GET",a),n.onerror=n.ontimeout=n.onabort=function(){t&&t(),t=null},e(n),n.send()},t=function(t,e,n){a(t,n,function(a){a.responseType="arraybuffer",a.onreadystatechange=function(){if(4==a.readyState){var t,r=new Uint8Array(a.response);for(t=0;4>t;t++)if(r[t]!="PEAK".charCodeAt(t))return n&&n();var o=r.length;if(o!=256*r[8]+r[9]+10)return n&&n();var c=new Array(o-10);for(t=10;o>t;t++)c[t-10]=r[t];e(c)}}})};this.getPeaks=t,this.getRandomTrack=function(e,n){var r="https://api.audiotool.com/tracks/relevant/?limit=";a(r+0,n,function(o){o.onreadystatechange=function(){if(4==o.readyState){var c=o.response.match(/<tracks.+?count="(\d+)/);if(c){var s=Math.random()*c[1]|0;a(r+"1&offset="+s,n,function(a){a.onreadystatechange=function(){if(4==a.readyState){var r=a.response+"",o={response:r};o.urls=[r.match(/<playbackURL.+?mpeg">([^<]+)/)[1],r.match(/<playbackURL.+?ogg">([^<]+)/)[1]],o.bpm=parseFloat(r.match(/<bpm>([^<]+)/)[1]),o.duration=.001*parseFloat(r.match(/<duration>([^<]+)/)[1]),o.cover=r.match(/<coverURL.+?512">([^<]+)/)[1];var c=r.match(/<name>([^<]+)/g);o.name=c[0].match(/>([^<]+)/)[1],o.author=c[1].match(/>([^<]+)/)[1],t(o.response.match(/<peaksURL.*?>([^<]+)/)[1],function(a){o.peaks=a,e(o)},n)}}})}else n&&n()}}})}}